<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>ç¾è‚¡åˆ†ææ¨èç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        .container {
            width: 90%;
            max-width: 1200px;
            margin: auto;
            padding: 20px;
        }
        h2 {
            color: #333;
        }
        form {
            margin-bottom: 30px;
        }
        input[type="text"] {
            padding: 10px;
            width: 300px;
            font-size: 16px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
        }
        .result, .recommendation {
            background: #fff;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        canvas {
            margin-top: 20px;
        }
        .placeholder {
            color: gray;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>ğŸ“ˆ è‚¡ç¥¨æ¨è</h2>
        <div class="recommendation">
            {% if recommended_stocks %}
                {% for stock in recommended_stocks %}
                    <h3>{{ stock.symbol }}</h3>
                    <p>å½“å‰ä»·æ ¼ï¼š{{ stock.current_price }} USD</p>
                    <p>æ¨èç†ç”±ï¼š{{ stock.recommendation_reason }}</p>
                    <p>å»ºè®®ä¹°å…¥ä»·ï¼š{{ stock.buy_price }}ï¼Œå»ºè®®å–å‡ºä»·ï¼š{{ stock.sell_price }}</p>
                {% endfor %}
            {% else %}
                <p class="placeholder">æš‚æ— åˆé€‚æ¨èï¼Œç¨åå†è¯•ã€‚</p>
            {% endif %}
        </div>

        <h2>ğŸ” ä¸ªè‚¡æŸ¥è¯¢</h2>
        <form method="post">
            <input type="text" name="stock_symbol" placeholder="è¾“å…¥è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ AAPLï¼‰" required>
            <button type="submit">æŸ¥è¯¢</button>
        </form>

        {% if stock_data %}
        <div class="result">
            <h3>{{ stock_data.symbol }}</h3>
            <p>å½“å‰ä»·æ ¼ï¼š{{ stock_data.current_price }} USD</p>
            <p>å‰ä¸€äº¤æ˜“æ—¥æ”¶ç›˜ï¼š{{ stock_data.previous_close }} USD</p>
            <p>æœ€æ–°è·å–æ—¶é—´ï¼š{{ stock_data.fetched_time }}</p>
            <p>MACD: {{ stock_data.macd }}ï¼ŒSignal: {{ stock_data.signal }}</p>
            <p>RSI: {{ stock_data.rsi }}</p>
            <p>KDJ: K={{ stock_data.kdj_k }}ï¼ŒD={{ stock_data.kdj_d }}ï¼ŒJ={{ stock_data.kdj_j }}</p>
            <p>Stochastic: K={{ stock_data.stochastic_k }}ï¼ŒD={{ stock_data.stochastic_d }}</p>
            <p>å»ºè®®ï¼š{{ stock_data.suggestion }}</p>
            <p>æ¨èä¹°å…¥ä»·ï¼š{{ stock_data.buy_price }}ï¼Œå–å‡ºä»·ï¼š{{ stock_data.sell_price }}</p>
            <p>åˆ†æé€»è¾‘ï¼š{{ stock_data.recommendation_reason }}</p>

            <canvas id="priceChart"></canvas>
            <canvas id="macdChart"></canvas>
            <canvas id="kdjChart"></canvas>
        </div>
        {% endif %}
    </div>

    <script>
        {% if stock_data and stock_data.chart %}
            const priceChart = document.getElementById('priceChart').getContext('2d');
            new Chart(priceChart, {
                type: 'line',
                data: {
                    labels: {{ stock_data.chart.dates|tojson }},
                    datasets: [{
                        label: 'ä»·æ ¼èµ°åŠ¿',
                        data: {{ stock_data.chart.prices|tojson }},
                        borderColor: 'blue',
                        fill: false,
                        tension: 0.2
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { display: true },
                        y: { display: true }
                    }
                }
            });

            const macdChart = document.getElementById('macdChart').getContext('2d');
            new Chart(macdChart, {
                type: 'line',
                data: {
                    labels: {{ stock_data.chart.dates|tojson }},
                    datasets: [
                        {
                            label: 'MACD',
                            data: {{ stock_data.chart.macd|tojson }},
                            borderColor: 'green',
                            fill: false
                        },
                        {
                            label: 'Signal',
                            data: {{ stock_data.chart.signal|tojson }},
                            borderColor: 'red',
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { display: true },
                        y: { display: true }
                    }
                }
            });

            const kdjChart = document.getElementById('kdjChart').getContext('2d');
            new Chart(kdjChart, {
                type: 'line',
                data: {
                    labels: {{ stock_data.chart.dates|tojson }},
                    datasets: [
                        {
                            label: 'K',
                            data: {{ stock_data.chart.kdj_k|tojson }},
                            borderColor: 'orange',
                            fill: false
                        },
                        {
                            label: 'D',
                            data: {{ stock_data.chart.kdj_d|tojson }},
                            borderColor: 'purple',
                            fill: false
                        },
                        {
                            label: 'J',
                            data: {{ stock_data.chart.kdj_j|tojson }},
                            borderColor: 'gray',
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { display: true },
                        y: { display: true }
                    }
                }
            });
        {% endif %}
    </script>
</body>
</html>
